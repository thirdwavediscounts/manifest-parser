---
phase: 02-standard-retailer-mappings
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/retailers/field-mappings.ts
  - tests/retailers/field-mappings.test.ts
autonomous: true

must_haves:
  truths:
    - "ACE manifest UPC column extracts to item_number"
    - "AMZ manifest ASIN column extracts to item_number"
    - "ATT manifest with UPC 'NOT AVAILABLE' produces blank item_number"
    - "Null values ('N/A', 'n/a', '-', 'none', '0000000000', 'not available') become blank"
    - "All 10 retailers have defined field configurations"
  artifacts:
    - path: "src/retailers/field-mappings.ts"
      provides: "Retailer field mapping configurations and extraction functions"
      exports: ["getRetailerFieldConfig", "isNullValue", "NULL_VALUES", "RetailerFieldConfig"]
    - path: "tests/retailers/field-mappings.test.ts"
      provides: "Test coverage for field mapping behavior"
      min_lines: 100
  key_links:
    - from: "field-mappings.ts"
      to: "base-parser.ts"
      via: "import getRetailerFieldConfig"
      pattern: "getRetailerFieldConfig"
---

<objective>
Create retailer-specific field mapping configurations that define how each retailer's manifest columns map to unified fields.

Purpose: Enable accurate field extraction from 10 different retailer manifest formats, handling each retailer's unique column naming conventions and null value patterns.

Output: Type-safe retailer configurations with tested null-value handling and column extraction logic.
</objective>

<execution_context>
@C:\Users\Shealtiel\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Shealtiel\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-standard-retailer-mappings/02-CONTEXT.md
@.planning/phases/01-unified-format-foundation/01-01-SUMMARY.md

Source files:
@src/parsers/types.ts
@src/parsers/base-parser.ts

Sample manifests in /csvs folder:
- ACE: UPC, Item #, Item Description, Qty, Unit Retail
- AMZ: ASIN, Item Description, Qty, Unit Retail
- ATT: UPC (with "NOT AVAILABLE"), Item Description, Qty, Unit Retail
- BY: UPC, Item Description, Quantity, Unit Retail
- JCP: Brand, Qty, Unit Retail (no unique identifier)
- QVC: Item #, Item Description, Qty, Unit Retail
- RC: Item #, Item Description, Qty, Unit Retail
- TGT: UPC, Item #, Item Description, Qty, Unit Retail
- B (B-Stock): Item #, Item Description, Qty, Unit Retail
</context>

<feature>
  <name>Retailer Field Mapping Configuration</name>
  <files>src/retailers/field-mappings.ts, tests/retailers/field-mappings.test.ts</files>
  <behavior>
    Null value handling:
    - isNullValue('NOT AVAILABLE') -> true
    - isNullValue('N/A') -> true
    - isNullValue('n/a') -> true (case-insensitive)
    - isNullValue('-') -> true
    - isNullValue('none') -> true
    - isNullValue('0000000000') -> true
    - isNullValue('Valid UPC') -> false
    - isNullValue('12345') -> false

    Retailer config retrieval:
    - getRetailerFieldConfig('ace') -> { itemNumber: ['UPC'], productName: ['Item Description'], qty: ['Qty'], unitRetail: ['Unit Retail'] }
    - getRetailerFieldConfig('amz') -> { itemNumber: ['ASIN'], productName: ['Item Description'], qty: ['Qty'], unitRetail: ['Unit Retail'] }
    - getRetailerFieldConfig('att') -> { itemNumber: ['UPC'], productName: ['Item Description'], qty: ['Qty'], unitRetail: ['Unit Retail'] }
    - getRetailerFieldConfig('by') -> { itemNumber: ['UPC'], productName: ['Item Description'], qty: ['Quantity'], unitRetail: ['Unit Retail'] }
    - getRetailerFieldConfig('costco') -> { itemNumber: ['Item #'], productName: ['Item Description'], qty: ['Qty'], unitRetail: ['Unit Retail'] }
    - getRetailerFieldConfig('jcp') -> { itemNumber: ['Item #', 'Brand'], productName: ['Brand', 'Subcategory'], qty: ['Qty'], unitRetail: ['Unit Retail'] }
    - getRetailerFieldConfig('qvc') -> { itemNumber: ['Item #'], productName: ['Item Description'], qty: ['Qty'], unitRetail: ['Unit Retail'] }
    - getRetailerFieldConfig('rc') -> { itemNumber: ['Item #', 'UPC'], productName: ['Item Description'], qty: ['Qty'], unitRetail: ['Unit Retail'] }
    - getRetailerFieldConfig('tgt') -> { itemNumber: ['UPC', 'Item #'], productName: ['Item Description'], qty: ['Qty'], unitRetail: ['Unit Retail'] }
    - getRetailerFieldConfig('tl') -> { itemNumber: ['UPC'], productName: ['Product Name'], qty: ['Quantity', 'Qty'], unitRetail: ['Orig. Retail', 'Unit Retail'] }
    - getRetailerFieldConfig('bstock') -> { itemNumber: ['Item #'], productName: ['Item Description'], qty: ['Qty'], unitRetail: ['Unit Retail'] }
    - getRetailerFieldConfig('unknown') -> default config with fallback columns

    Field extraction with null handling:
    - extractField({ UPC: 'NOT AVAILABLE' }, ['UPC']) -> '' (null value)
    - extractField({ UPC: '123456789' }, ['UPC']) -> '123456789'
    - extractField({ 'Item Description': 'Widget' }, ['Item Description']) -> 'Widget'
    - extractField({ 'Unknown Col': 'value' }, ['Item Description', 'Description']) -> '' (column not found)
  </behavior>
  <implementation>
    1. Define RetailerFieldConfig interface with itemNumber, productName, qty, unitRetail arrays
    2. Define NULL_VALUES constant array with case-normalized values
    3. Implement isNullValue(value: string): boolean - case-insensitive check
    4. Create RETAILER_CONFIGS map with all 10 retailer configurations
    5. Implement getRetailerFieldConfig(retailerId: string): RetailerFieldConfig
    6. Implement extractField(row: RawRow, columnNames: string[]): string - returns first matching column value, applying null-value handling
    7. Export all public functions and types
  </implementation>
</feature>

<verification>
After TDD cycle completes:

```bash
# Run tests
npm test -- --testPathPattern="field-mappings"

# Verify TypeScript compiles
npx tsc --noEmit

# Verify exports are accessible
grep -n "export" src/retailers/field-mappings.ts
```
</verification>

<success_criteria>
- All tests pass for null-value detection
- All tests pass for retailer config retrieval (10 retailers)
- All tests pass for field extraction with null handling
- TypeScript compiles without errors
- At least 10 test cases covering edge cases
</success_criteria>

<output>
After completion, create `.planning/phases/02-standard-retailer-mappings/02-01-SUMMARY.md`
</output>
