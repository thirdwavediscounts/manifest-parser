---
phase: 08-metadata-dom-audit
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/SELECTORS.md
  - .planning/codebase/SELECTORS.md
  - src/retailers/sites/bstock-auction.ts
  - src/retailers/sites/techliquidators.ts
  - src/retailers/sites/amazon.ts
  - src/retailers/sites/bstock.ts
autonomous: true

must_haves:
  truths:
    - "Each retailer has documented CSS selectors for bid price extraction"
    - "Each retailer has documented CSS selectors for shipping fee extraction"
    - "Inline comments explain what element is targeted and why"
    - "Reference file includes audit trail with selectors and HTML patterns"
  artifacts:
    - path: "docs/SELECTORS.md"
      provides: "Primary selector reference with audit trail"
      contains: "ACE.*AMZ.*AMZD.*ATT.*COSTCO.*BY.*JCP.*QVC.*RC.*TGT.*TL"
    - path: ".planning/codebase/SELECTORS.md"
      provides: "Planning context mirror"
      contains: "DOM Selector"
  key_links:
    - from: "docs/SELECTORS.md"
      to: "src/retailers/sites/*.ts"
      via: "References inline code locations"
      pattern: "src/retailers/sites"
---

<objective>
Document all bid price and shipping fee DOM selectors for the 11 retailers (10 standard + AMZD).

Purpose: Create comprehensive reference documentation and inline code comments explaining what DOM elements are targeted and why selectors work, enabling future maintenance when retailer sites change structure.

Output: docs/SELECTORS.md reference file, .planning mirror, and enhanced inline comments in all retailer module files.
</objective>

<execution_context>
@C:\Users\Shealtiel\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Shealtiel\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-metadata-dom-audit/08-CONTEXT.md
@src/retailers/sites/bstock-auction.ts
@src/retailers/sites/techliquidators.ts
@src/retailers/sites/amazon.ts
@src/retailers/sites/bstock.ts
@src/retailers/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create comprehensive SELECTORS.md reference documentation</name>
  <files>docs/SELECTORS.md, .planning/codebase/SELECTORS.md</files>
  <action>
Create docs/SELECTORS.md with the following structure:

1. **Header section** with purpose statement and last-verified date placeholder

2. **Retailer sections** (alphabetical order): ACE, AMZ, AMZD, ATT, BY, COSTCO, JCP, QVC, RC, TGT, TL

For EACH retailer section, document:
- **Bid Price Selectors**: The CSS selectors used (from existing code)
- **Shipping Fee Selectors**: The CSS selectors used (from existing code)
- **Fallback Patterns**: Regex patterns used as fallback
- **Example HTML Snippet**: Show target element structure (use placeholder HTML that demonstrates what we're looking for)
- **Notes**: Special behaviors (e.g., AMZD is fixed-price so bidPrice always null)
- **Source File**: Link to the source code file (e.g., `src/retailers/sites/bstock-auction.ts`)
- **Last Verified**: Date placeholder for manual verification

Extract selector information from these existing files:
- `src/retailers/sites/bstock.ts` - handles AMZ, ATT, COSTCO, TGT, RC (via B-Stock marketplace)
- `src/retailers/sites/bstock-auction.ts` - handles ACE, BY, JCP, QVC (via B-Stock auction pages)
- `src/retailers/sites/techliquidators.ts` - handles TL
- `src/retailers/sites/amazon.ts` - handles AMZD

3. **Fallback Behavior section** explaining:
- When selector finds nothing: log warning + return null
- User-facing status message: "Could not extract bid price from [retailer]..."
- No backup selectors - document only current working selector

4. **Maintenance section** explaining how to update selectors when sites change

Also create `.planning/codebase/SELECTORS.md` as a mirror copy for planning context.
  </action>
  <verify>
- docs/SELECTORS.md exists and contains all 11 retailers
- .planning/codebase/SELECTORS.md exists and matches docs/SELECTORS.md
- Each retailer has bid price and shipping fee sections
- grep -c "### ACE\|### AMZ\|### AMZD\|### ATT\|### BY\|### COSTCO\|### JCP\|### QVC\|### RC\|### TGT\|### TL" docs/SELECTORS.md returns 11
  </verify>
  <done>
Reference documentation exists with documented selectors for all 11 retailers, including example HTML patterns and maintenance notes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add descriptive inline comments to retailer module selector functions</name>
  <files>src/retailers/sites/bstock-auction.ts, src/retailers/sites/techliquidators.ts, src/retailers/sites/amazon.ts, src/retailers/sites/bstock.ts</files>
  <action>
Add descriptive inline comments to each extractBidPrice() and extractShippingFee() function explaining:

1. **Function-level comment** (already exists, enhance if needed):
   - What the function extracts
   - Which retailers this applies to

2. **Selector array comment** explaining the selectors tried:
   ```typescript
   // Bid price selectors tried in order:
   // - [class*="bid-amount"]: B-Stock marketplace bid display element
   // - [class*="current-bid"]: Alternative bid label container
   // - [id*="currentBid"]: ID-based selector for some page layouts
   ```

3. **Fallback pattern comment** explaining regex patterns:
   ```typescript
   // Fallback: Search page text for "Current Bid: $X,XXX" pattern
   // This catches bid amounts even if CSS selectors fail due to layout changes
   ```

4. **Special case comments**:
   - In amazon.ts: "AMZD is fixed-price, not auction, so bidPrice always null"
   - In any shipping function: "Free shipping check returns 0, not found returns null"

Style guidelines:
- Use descriptive comments that explain WHAT element is targeted and WHY the selector works
- Keep comments concise but informative
- Do not change any actual code logic - only add/enhance comments
  </action>
  <verify>
- grep -c "Bid price selectors" src/retailers/sites/*.ts returns 4 (one per file)
- grep -c "Shipping.*selectors" src/retailers/sites/*.ts returns 4 (one per file)
- npx tsc --noEmit passes (comments don't break compilation)
  </verify>
  <done>
All 4 retailer module files have descriptive inline comments explaining selector targets and fallback patterns.
  </done>
</task>

</tasks>

<verification>
1. Documentation complete:
   - docs/SELECTORS.md contains all 11 retailers
   - Each retailer has bid price and shipping fee documentation
   - Fallback behavior documented

2. Code comments enhanced:
   - All 4 retailer module files have selector comments
   - Comments explain what elements are targeted
   - Comments explain why selectors work

3. Build passes:
   - npx tsc --noEmit succeeds
   - No breaking changes to existing functionality
</verification>

<success_criteria>
- docs/SELECTORS.md exists with documented selectors for all 11 retailers
- .planning/codebase/SELECTORS.md mirrors the documentation
- All 4 retailer module files have enhanced inline comments
- TypeScript compilation succeeds
- No functional code changes (comments only in Task 2)
</success_criteria>

<output>
After completion, create `.planning/phases/08-metadata-dom-audit/08-01-SUMMARY.md`
</output>
