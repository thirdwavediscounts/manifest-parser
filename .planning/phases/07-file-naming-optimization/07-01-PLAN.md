---
phase: 07-file-naming-optimization
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/utils/filename-utils.ts
  - tests/utils/filename-utils.test.ts
autonomous: true

must_haves:
  truths:
    - "Common words abbreviated: Accessories → Acc, Electronics → Elec"
    - "Truncation never cuts mid-word"
    - "Multi-category titles deduplicated: 'X Acc & Y Acc' → 'X & Y Acc'"
  artifacts:
    - path: "src/utils/filename-utils.ts"
      provides: "Smart truncation functions"
      exports: ["abbreviateCommonWords", "truncateAtWordBoundary", "optimizeMultiCategory", "smartTruncateTitle"]
    - path: "tests/utils/filename-utils.test.ts"
      provides: "Test coverage for filename utilities"
      min_lines: 50
  key_links:
    - from: "tests/utils/filename-utils.test.ts"
      to: "src/utils/filename-utils.ts"
      via: "import statements"
      pattern: "import.*filename-utils"
---

<objective>
Create utility functions for smart filename title truncation using TDD.

Purpose: Filenames from auction listings often exceed reasonable length limits and contain repetitive category words. Smart truncation improves readability while respecting file system limits.

Output:
- `src/utils/filename-utils.ts` with exported functions
- `tests/utils/filename-utils.test.ts` with passing tests
</objective>

<execution_context>
@C:\Users\Shealtiel\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Shealtiel\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/popup/popup.ts (lines 1275-1336 for current generateListingFilename implementation)
</context>

<feature>
  <name>Filename Utility Functions</name>
  <files>src/utils/filename-utils.ts, tests/utils/filename-utils.test.ts</files>
  <behavior>
    **abbreviateCommonWords(title: string): string**
    - Input: "PC Gaming Accessories" → Output: "PC Gaming Acc"
    - Input: "Electronics & Appliances" → Output: "Elec & Appl"
    - Input: "Mixed Household Items" → Output: "Mixed HH Items"
    - Abbreviation map: Accessories→Acc, Electronics→Elec, Appliances→Appl,
      Computer→Comp, Technology→Tech, Hardware→HW, Software→SW,
      Furniture→Furn, Equipment→Equip, Warehouse→WH, Household→HH

    **truncateAtWordBoundary(title: string, maxLen: number): string**
    - Input: "PC-Gaming-Accessories-Bundle", 20 → Output: "PC-Gaming-Acc" (if abbreviated first)
    - Input: "Electronics-And-More", 15 → Output: "Electronics-And" (not "Electronics-An")
    - Must respect dash as word separator (filenames use dashes not spaces)
    - Never returns partial word at end

    **optimizeMultiCategory(title: string): string**
    - Input: "PC Gaming Accessories & Tablet Accessories" → Output: "PC Gaming & Tablet Acc"
    - Input: "Kitchen Electronics & Office Electronics" → Output: "Kitchen & Office Elec"
    - Deduplicates repeated category words, keeps last occurrence abbreviated
    - Handles "&" as category separator

    **smartTruncateTitle(title: string, maxLen: number): string**
    - Combines all above: optimize multi-category → abbreviate → truncate at word boundary
    - Input: "PC Gaming Accessories & Tablet Accessories", 30 → Output: "PC Gaming & Tablet Acc"
    - Always returns string <= maxLen
  </behavior>
  <implementation>
    1. Create abbreviation map as const object
    2. Implement abbreviateCommonWords using regex replace with map lookup
    3. Implement truncateAtWordBoundary finding last dash before maxLen
    4. Implement optimizeMultiCategory detecting repeated category words around "&"
    5. Implement smartTruncateTitle chaining the above functions

    Use case-insensitive matching for abbreviations but preserve original case where possible.
  </implementation>
</feature>

<verification>
```bash
npx vitest run tests/utils/filename-utils.test.ts
npx tsc --noEmit
```
</verification>

<success_criteria>
- All tests pass
- No TypeScript errors
- Functions handle edge cases: empty string, single word, no abbreviatable words
- smartTruncateTitle always returns string <= maxLen
</success_criteria>

<output>
After completion, create `.planning/phases/07-file-naming-optimization/07-01-SUMMARY.md`
</output>
