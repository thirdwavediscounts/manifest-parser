# Milestone v1.1: Metadata Fix + Verification

**Status:** SHIPPED 2026-01-29
**Phases:** 10-13
**Total Plans:** 6

## Overview

Fix metadata extraction returning 0 for 9 of 11 retailers, fix AMZD CSV parsing issues, and E2E verify each retailer group against live auction pages as fixes are applied.

## Phases

### Phase 10: Playwright E2E Infrastructure
**Goal**: Set up Playwright test infrastructure for Chrome extension E2E testing
**Depends on**: Nothing (first phase)
**Plans**: 1 plan

Plans:
- [x] 10-01-PLAN.md — Install Playwright, create extension helpers, TL smoke test

### Phase 11: B-Stock Classic Selector Fix + E2E
**Goal**: ACE, BY, JCP, and QVC return correct bid_price and shipping_fee — verified E2E against live pages
**Depends on**: Phase 10
**Plans**: 1 plan

Plans:
- [x] 11-01-PLAN.md — Fix B-Stock Classic selectors and E2E verify against live pages

### Phase 12: B-Stock Next.js JSON Fix + E2E
**Goal**: AMZ, ATT, COSTCO, RC, and TGT return correct bid_price and shipping_fee via __NEXT_DATA__ — verified E2E
**Depends on**: Phase 10
**Plans**: 2 plans

Plans:
- [x] 12-01-PLAN.md — Create per-retailer JSON path config and refactor bstock.ts extraction
- [x] 12-02-PLAN.md — Playwright E2E tests for all 5 Next.js retailers

### Phase 13: AMZD CSV + Metadata Fix + E2E
**Goal**: Amazon Direct raw CSV downloads preserve all rows with correct columns, metadata works — verified E2E
**Depends on**: Phase 10
**Plans**: 2 plans

Plans:
- [x] 13-01-PLAN.md — Fix AMZD CSV parsing (raw line-level append + unified __parsed_extra handling)
- [x] 13-02-PLAN.md — Fix AMZD metadata extraction + E2E verify

## Milestone Summary

**Key Decisions:**
- Phase 10 = Playwright setup, then 11/12/13 parallel (each includes E2E)
- E2E verification integrated into each fix phase, not separate
- AMZD is fixed-price (bid_price returns null, not 0)
- .pw.test.ts suffix for Playwright tests (coexists with vitest)
- Test metadata via page.evaluate() with selectors (not popup UI flow)
- Classic shipping deferred behind login+address confirmation (returns null without auth)

**Issues Resolved:**
- Metadata extraction returning 0 for 9 of 11 retailers
- AMZD raw CSV truncation from embedded newlines
- AMZD column bleeding from __parsed_extra not being spread into cells
- Raw mode was re-parsing CSV instead of line-level append

**Issues Deferred:**
- DST handling in convertToPstMilitary (bstock.ts) — times off by 1 hour during summer
- nextjs-paths.ts inline mirror in bstock.ts must be manually synced with config file

**Technical Debt Incurred:**
- 4/5 Next.js E2E test URLs expired (TGT passes, others skip gracefully)
- E2E-04 row count verification is partial (checks download link, not full blob row count)
- BY E2E test skipped (requires authentication)

---
*For current project status, see .planning/ROADMAP.md*
