class u{matches(t){return this.urlPatterns.some(e=>e.test(t))}getSiteInfo(){return{site:this.siteName,url:window.location.href,isAuthenticated:this.isAuthenticated()}}findManifestLinks(){const t=[];return document.querySelectorAll("a[href]").forEach(s=>{const a=s.href,n=this.parseManifestLink(a);n&&t.push(n)}),this.deduplicateManifests(t)}parseManifestLink(t){const e=t.toLowerCase();if(e.includes(".csv")||e.includes("format=csv"))return{url:t,filename:this.extractFilename(t,"csv"),type:"csv"};if(e.includes(".xlsx")||e.includes("format=xlsx"))return{url:t,filename:this.extractFilename(t,"xlsx"),type:"xlsx"};if(e.includes(".xls")&&!e.includes(".xlsx"))return{url:t,filename:this.extractFilename(t,"xls"),type:"xls"};if(e.includes("manifest")||e.includes("inventory")||e.includes("itemlist")){const s=this.guessTypeFromUrl(t);if(s)return{url:t,filename:this.extractFilename(t,s),type:s}}return null}extractFilename(t,e){try{const n=new URL(t).pathname.split("/"),r=n[n.length-1];if(r&&r.includes("."))return decodeURIComponent(r);const l=new Date().toISOString().split("T")[0];return`manifest_${this.siteName}_${l}.${e}`}catch{return`manifest_${this.siteName}.${e}`}}guessTypeFromUrl(t){const e=t.toLowerCase();return e.includes("xlsx")?"xlsx":e.includes("xls")?"xls":e.includes("csv")||e.includes("download")||e.includes("export")?"csv":null}deduplicateManifests(t){const e=new Set;return t.filter(s=>e.has(s.url)?!1:(e.add(s.url),!0))}}function c(i){chrome.runtime.onMessage.addListener((t,e,s)=>{switch(t.type){case"GET_SITE_INFO":s({type:"SITE_INFO",payload:i.getSiteInfo()});break;case"DETECT_MANIFESTS":s({type:"MANIFESTS_DETECTED",payload:i.detectManifests()});break;default:s({type:"ERROR",error:`Unknown message type: ${t.type}`})}return!0})}export{u as M,c as s};
